╔═══════════════════════════════════════════════════════════════════════════╗
║                                                                           ║
║          Test Suite for comfy-run-remote.sh - Quick Reference           ║
║                                                                           ║
╚═══════════════════════════════════════════════════════════════════════════╝

QUICK START
═══════════════════════════════════════════════════════════════════════════

1. Run all tests:
   $ bash run-all-tests.sh

2. View results:
   $ cat test-report-*.txt | tail -50

3. Run specific test:
   $ bash test-remote-runner.sh      # Comprehensive (no pod needed)
   $ bash test-pod-connectivity.sh   # Connectivity tests (requires pod)
   $ bash test-workflow-api.sh       # API tests (requires pod)


SETUP (Pod ID Changes Daily!)
═══════════════════════════════════════════════════════════════════════════

Step 1: Get current pod ID (changes daily!):
   $ runpodctl pod list
   # Shows: zu9sxe2gu0lswm  ghcr.io/maroshi/flux2-dev-turbo  RUNNING

Step 2: Set pod URL with RunPod proxy:
   $ export RUNPOD_POD_URL="https://zu9sxe2gu0lswm-8188.proxy.runpod.net"
   # Replace 'zu9sxe2gu0lswm' with YOUR pod ID from step 1

Step 3: Run tests:
   $ bash test-pod-connectivity.sh

Enable debug:
   $ DEBUG=1 bash test-remote-runner.sh


FILES CREATED (87 KB total)
═══════════════════════════════════════════════════════════════════════════

Test Scripts (4):
  ✓ test-remote-runner.sh       (20 KB) - Main comprehensive test suite
  ✓ test-pod-connectivity.sh    (12 KB) - Pod connectivity & diagnostics
  ✓ test-workflow-api.sh        (14 KB) - API interaction tests
  ✓ run-all-tests.sh            (11 KB) - Master test runner

Documentation (3):
  ✓ TEST_VALUES.md              (11 KB) - Test values, mock responses
  ✓ RUN_TESTS.md                (8 KB)  - Quick start guide
  ✓ TEST_SUITE_SUMMARY.md       (12 KB) - Complete test overview
  ✓ QUICK_REFERENCE.txt         (This)  - Quick command reference


TEST COVERAGE
═══════════════════════════════════════════════════════════════════════════

Core Functionality:
  ✓ Script help and validation
  ✓ Parameter parsing and validation
  ✓ Workflow file handling
  ✓ Seed generation
  ✓ Output directory management
  ✓ Logging functionality

Connectivity & Network:
  ✓ HTTP endpoint accessibility
  ✓ SSH connection parsing
  ✓ Connection timeout handling
  ✓ Network diagnostics

API Interaction:
  ✓ /system_stats endpoint
  ✓ /queue endpoint
  ✓ /prompt submission format
  ✓ /history response parsing
  ✓ /view endpoint URL construction

Error Handling:
  ✓ Missing arguments
  ✓ Invalid workflows
  ✓ Unreachable pods
  ✓ Network timeouts
  ✓ Invalid responses

Performance:
  ✓ Response time measurement
  ✓ Concurrent request handling
  ✓ Bandwidth estimation


COMMON COMMANDS
═══════════════════════════════════════════════════════════════════════════

Check prerequisites:
  $ command -v curl jq python3 envsubst

Run basic connectivity test:
  $ bash test-pod-connectivity.sh

Run comprehensive tests (no pod required):
  $ bash test-remote-runner.sh

Debug specific test:
  $ bash -x test-workflow-api.sh 2>&1 | grep -i "fail\|error"

View pod status:
  $ runpodctl pod list
  $ runpodctl pod status zu9sxe2gu0lswm

Manual API test:
  $ POD_URL="http://104.255.9.187:8188"
  $ curl -s "$POD_URL/system_stats" | jq .

Check test results:
  $ tail -50 test-results.log
  $ tail -50 test-report-*.txt


TEST STATISTICS
═══════════════════════════════════════════════════════════════════════════

Total test files:        4 scripts
Total code:             ~57 KB
Test suites:            16 major categories
Individual tests:       50+ tests
Expected duration:      10-20 minutes (full suite)

Without pod:            5-10 minutes
With pod:               2-3 minutes per script


EXPECTED OUTPUT
═══════════════════════════════════════════════════════════════════════════

Successful run:
  [PASS] All tests passed!
  Success Rate: 95%+
  Tests:
    ✓ PASSED: 45+
    ✓ FAILED: 0
    ✓ SKIPPED: 0-2 (if pod unavailable)

With pod unavailable:
  [SKIP] Pod is not accessible (may be offline)
  Tests:
    ✓ PASSED: 30+
    ✓ FAILED: 0
    ✓ SKIPPED: 15+ (connectivity tests)


TROUBLESHOOTING
═══════════════════════════════════════════════════════════════════════════

Pod not accessible:
  1. Check pod running: runpodctl pod list
  2. Verify URL: echo $RUNPOD_POD_URL
  3. Test connectivity: curl http://104.255.9.187:8188/system_stats

Test failures:
  1. Review log: cat test-results.log | grep FAIL
  2. Enable debug: DEBUG=1 bash test-remote-runner.sh
  3. Check pod logs: runpodctl pod logs zu9sxe2gu0lswm

Missing dependencies:
  1. Install curl: apt-get install curl
  2. Install jq: apt-get install jq
  3. Install python3: apt-get install python3
  4. Install envsubst: apt-get install gettext-base


NEXT STEPS
═══════════════════════════════════════════════════════════════════════════

1. Run test suite:
   $ bash run-all-tests.sh

2. Review implementation plan:
   $ cat .claude/plans/clever-swimming-breeze.md

3. Implement comfy-run-remote.sh:
   $ cp comfy-run.sh comfy-run-remote.sh
   $ # Follow implementation plan and modify accordingly

4. Test implementation:
   $ ./comfy-run-remote.sh --prompt "test" --pod-url $RUNPOD_POD_URL

5. Compare with local execution:
   $ time ./comfy-run.sh --prompt "test" --seed 42
   $ time ./comfy-run-remote.sh --prompt "test" --seed 42

6. Deploy to production:
   $ bash run-all-tests.sh  # Verify all tests pass
   $ git add comfy-run-remote.sh
   $ git commit -m "Add remote ComfyUI execution support"


POD CONFIGURATION REFERENCE (Get Current Values!)
═══════════════════════════════════════════════════════════════════════════

Command to get current pod info:
   $ runpodctl pod list

Pod Name:            ghcr.io/maroshi/flux2-dev-turbo:latest
GPU:                 1 x A100 PCIe 80GB
Port:                8188

IMPORTANT: Pod ID and IP change when you restart!
Get them fresh each time with: runpodctl pod list

Proxy URL Format (Pod ID changes daily!):
   https://{POD_ID}-8188.proxy.runpod.net

Example:
   https://zu9sxe2gu0lswm-8188.proxy.runpod.net

Always get current POD_ID from: runpodctl pod list


API ENDPOINTS REFERENCE
═══════════════════════════════════════════════════════════════════════════

System Info:
  GET /system_stats
  Returns: {"system": "...", "python_version": "...", "devices": [...]}

Queue Status:
  GET /queue
  Returns: {"queue_pending": [...], "queue_running": [...]}

Submit Workflow:
  POST /prompt
  Body: {"prompt": {...}, "client_id": "..."}
  Returns: {"prompt_id": "uuid", "number": 1}

Get Results:
  GET /history/{prompt_id}
  Returns: {"prompt_id": {"outputs": {...}, "status": {...}}}

Download Image:
  GET /view?filename={FILE}&subfolder={DIR}&type=output
  Returns: Binary image data (PNG)


USEFUL ENVIRONMENT VARIABLES
═══════════════════════════════════════════════════════════════════════════

export RUNPOD_POD_URL="http://104.255.9.187:8188"
export RUNPOD_SSH_CONNECTION="root@104.255.9.187:11597"
export RUNPOD_POD_ID="zu9sxe2gu0lswm"
export DEBUG=1                    # Enable debug output
export TIMEOUT=3600              # Max execution time
export SKIP_DOWNLOAD=1           # Don't download images


PERFORMANCE BENCHMARKS
═══════════════════════════════════════════════════════════════════════════

Connectivity check:      100-200 ms
Workflow submission:     200-500 ms
Single poll:             50-100 ms
Image download (1MB):    1-2 seconds
Full workflow cycle:     30-60 seconds


COMMON TEST SCENARIOS
═══════════════════════════════════════════════════════════════════════════

Basic test:
  $ ./comfy-run-remote.sh --prompt "A red car" --seed 42

With custom output:
  $ ./comfy-run-remote.sh --prompt "test" --local-output ./images/

From SSH connection:
  $ ./comfy-run-remote.sh --ssh-connection "root@104.255.9.187:11597" \
    --prompt "test"

Batch processing:
  $ for i in {1..5}; do
      ./comfy-run-remote.sh --prompt "Image $i" --image-id "batch_$i"
    done

No download mode:
  $ ./comfy-run-remote.sh --prompt "test" --no-download

Short timeout (testing):
  $ ./comfy-run-remote.sh --prompt "test" --timeout 10


FILES & LOCATIONS
═══════════════════════════════════════════════════════════════════════════

Test files:
  ~/dev/image-generation-prompt/rundpod-flux2-dev-turbo/workflows/

Implementation plan:
  ~/.claude/plans/clever-swimming-breeze.md

Pod SSH:
  ssh root@104.255.9.187 -p 11597

ComfyUI interface:
  http://104.255.9.187:8188


GETTING HELP
═══════════════════════════════════════════════════════════════════════════

Script help:
  $ ./comfy-run-remote.sh --help

Test help:
  $ bash test-remote-runner.sh --help

Documentation:
  - TEST_VALUES.md: Test values and mock data
  - RUN_TESTS.md: Detailed setup guide
  - TEST_SUITE_SUMMARY.md: Complete overview

Manual testing:
  $ POD_URL="http://104.255.9.187:8188"
  $ curl -i "$POD_URL/system_stats"


═══════════════════════════════════════════════════════════════════════════

Created: 2026-01-31
Test Suite Version: 1.0
Status: Ready for implementation testing

═══════════════════════════════════════════════════════════════════════════
